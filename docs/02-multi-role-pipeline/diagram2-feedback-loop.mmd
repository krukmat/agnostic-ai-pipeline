sequenceDiagram
    participant Dev as Developer
    participant QA as QA Engineer
    participant Arch as Architect

    Note over Dev: Implements Story S1<br/>(based on acceptance criteria)
    Dev->>QA: Submit code + tests (status: in_review)

    Note over QA: Validates implementation<br/>against acceptance criteria

    alt QA Approves
        QA->>Dev: ✓ Approved
        Note over Dev: Story marked 'done'
    else QA Rejects (ARCHITECT_INTERVENTION=1)
        QA->>Arch: ✗ Rejected with feedback
        Note over Arch: Reads QA feedback<br/>Refines story criteria
        Arch->>Dev: Updated story with refined criteria
        Note over Dev: Implements again<br/>(retry with better spec)
        Dev->>QA: Resubmit code + tests
        Note over QA: Validates again
        QA->>Dev: ✓ Approved (2nd attempt)
    else QA Rejects (ARCHITECT_INTERVENTION=0)
        QA->>Dev: ✗ Rejected (no refinement)
        Note over Dev: Story back to 'todo'<br/>(same criteria)
        Dev->>QA: Resubmit code + tests
        QA->>Dev: ✓ Approved (2nd attempt)
    end
